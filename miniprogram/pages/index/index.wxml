<!-- pages/index/index.wxml -->
<view class="container">
  <view class="header">
    <view class="header-top">
      <image class="logo" src="/assets/logo.png" mode="aspectFit"></image>
      <view class="history-btn" bindtap="navigateToHistory">
        <text class="history-icon">ğŸ“‹</text>
      </view>
    </view>
    <view class="title">é«˜è€ƒå¿—æ„¿å¡«æŠ¥åŠ©æ‰‹</view>
    <view class="subtitle">AIæ™ºèƒ½åˆ†æï¼Œå¼ é›ªå³°é£æ ¼è§£ç­”å¿—æ„¿å¡«æŠ¥éš¾é¢˜</view>
  </view>

  <block wx:if="{{!showResult}}">
    <view class="question-container">
      <view class="progress">
        <text>é—®é¢˜ {{currentQuestionIndex + 1}}/{{questions.length}}</text>
        <text>{{progressPercent}}%</text>
      </view>
      <view class="progress-bar">
        <view class="progress-inner" style="width: {{progressPercent}}%"></view>
      </view>
      
      <view class="question">
        <text class="question-text">{{questions[currentQuestionIndex]}}</text>
        
        <!-- çœä»½é€‰æ‹©å™¨ -->
        <block wx:if="{{currentQuestionIndex === 1}}">
          <picker 
            class="province-picker" 
            range="{{provinces}}" 
            value="{{selectedProvinceIndex}}" 
            bindchange="handleProvinceChange"
          >
            <view class="picker-content">
              <text wx:if="{{!answers[1]}}">è¯·é€‰æ‹©çœä»½</text>
              <text wx:else>{{answers[1]}}</text>
            </view>
          </picker>
        </block>
        
        <!-- æ–‡ç†ç§‘é€‰æ‹©å™¨ -->
        <block wx:elif="{{currentQuestionIndex === 2}}">
          <picker 
            class="subject-picker" 
            range="{{subjects}}" 
            value="{{selectedSubjectIndex}}" 
            bindchange="handleSubjectChange"
          >
            <view class="picker-content">
              <text wx:if="{{!answers[2]}}">è¯·é€‰æ‹©æ–‡ç†ç§‘</text>
              <text wx:else>{{answers[2]}}</text>
            </view>
          </picker>
        </block>
        
        <!-- å­¦ç§‘å…´è¶£å¤šé€‰ -->
        <block wx:elif="{{currentQuestionIndex === 3}}">
          <view class="radio-container">
            <view class="selection-hint">
              å½“å‰é€‰æ‹©: <text class="count">{{selectedInterest !== null ? interestSubjects[selectedInterest] : 'æœªé€‰æ‹©'}}</text>
            </view>
            <radio-group class="radio-group" bindchange="toggleInterest">
              <label class="radio-item" wx:for="{{interestSubjects}}" wx:key="*this">
                <radio 
                  value="{{index}}"
                  checked="{{selectedInterest === index}}"
                  data-index="{{index}}"
                  color="#07C160"
                />
                <text class="radio-text">{{item}}</text>
              </label>
            </radio-group>
          </view>
        </block>
        
        <!-- å…¶ä»–é—®é¢˜çš„æ–‡æœ¬è¾“å…¥ -->
        <block wx:else>
          <textarea 
            class="answer-input" 
            placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„æƒ…å†µï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆæ›´å‡†ç¡®çš„å¿—æ„¿å¡«æŠ¥å»ºè®®..." 
            value="{{answers[currentQuestionIndex]}}"
            bindinput="handleInput"
            auto-height
            maxlength="-1"
          ></textarea>
        </block>
      </view>
      
      <view class="buttons">
        <button 
          class="btn prev" 
          bindtap="prevQuestion" 
          disabled="{{currentQuestionIndex === 0}}"
        >
          <text class="btn-icon">â†</text>
          <text>ä¸Šä¸€é¢˜</text>
        </button>
        <button 
          class="btn next" 
          bindtap="nextQuestion"
        >
          <text>{{currentQuestionIndex === questions.length - 1 ? 'ç”Ÿæˆæç¤ºè¯' : 'ä¸‹ä¸€é¢˜'}}</text>
          <text class="btn-icon">{{currentQuestionIndex === questions.length - 1 ? 'âœ“' : 'â†’'}}</text>
        </button>
      </view>
    </view>
  </block>

  <block wx:else>
    <view class="result-container">
      <view class="result-title">æ‚¨çš„å¿—æ„¿å¡«æŠ¥åˆ†æå·²ç”Ÿæˆ</view>
      <view class="result-tips">å¤åˆ¶ä»¥ä¸‹å†…å®¹åˆ°AIåŠ©æ‰‹ï¼ˆå¦‚DeepSeekã€è…¾è®¯å…ƒå®ç­‰ï¼‰ï¼Œè·å–è¯¦ç»†çš„å¿—æ„¿å¡«æŠ¥å»ºè®®</view>
      
      <scroll-view class="prompt-box" scroll-y>
        <text>{{promptText}}</text>
      </scroll-view>
      
      <view class="result-buttons">
        <button class="btn copy" bindtap="copyPrompt">
          <text class="btn-icon">ğŸ“‹</text>
          <text>ä¸€é”®å¤åˆ¶</text>
        </button>
        <button class="btn history" bindtap="navigateToHistory">
          <text class="btn-icon">ï¿½</text>
          <text>å†å²è®°å½•</text>
        </button>
        <button class="btn restart" bindtap="restartQuestions">
          <text class="btn-icon">ğŸ”„</text>
          <text>é‡æ–°å¼€å§‹</text>
        </button>
      </view>

    </view>
  </block>

  <!-- åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨ç”Ÿæˆåˆ†æ...</text>
  </view>

  <view class="footer">
    <text>Â© 2025 å­¦é€”ç½—ç›˜ - é«˜è€ƒå¿—æ„¿å¡«æŠ¥åŠ©æ‰‹</text>
  </view>
</view>